"use strict";app.factory("authService",["$http","$q","localStorageService","ngAuthSettings",function(e,t,r,s){var n=s.apiServiceBaseUri,o={},a={isAuth:!1,email:"",useRefreshTokens:!1},i={provider:"",email:"",externalAccessToken:""},u=function(t){return h(),e.post(n+"api/accounts/create",t).then(function(e){return e})},c=function(o){var i="grant_type=password&username="+o.email+"&password="+o.password;o.useRefreshTokens&&(i=i+"&client_id="+s.clientId);var u=t.defer();return e.post(n+"token",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.useRefreshTokens?r.set("authorizationData",{token:e.access_token,email:o.email,refreshToken:e.refresh_token,useRefreshTokens:!0}):r.set("authorizationData",{token:e.access_token,email:o.email,refreshToken:"",useRefreshTokens:!1}),a.isAuth=!0,a.email=o.email,a.useRefreshTokens=o.useRefreshTokens,u.resolve(e)}).error(function(e,t){h(),u.reject(e)}),u.promise},f=function(t){return e.get(n+"accounts/user?username="+t).then(function(e){return e})},h=function(){r.remove("authorizationData"),a.isAuth=!1,a.email="",a.useRefreshTokens=!1},l=function(){var e=r.get("authorizationData");e&&(a.isAuth=!0,a.email=e.email,a.useRefreshTokens=e.useRefreshTokens)},k=function(){var o=t.defer(),a=r.get("authorizationData");if(a&&a.useRefreshTokens){var i="grant_type=refresh_token&refresh_token="+a.refreshToken+"&client_id="+s.clientId;r.remove("authorizationData"),e.post(n+"token",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.set("authorizationData",{token:e.access_token,email:e.email,refreshToken:e.refresh_token,useRefreshTokens:!0}),o.resolve(e)}).error(function(e,t){h(),o.reject(e)})}return o.promise},m=function(s){var o=t.defer();return e.get(n+"api/account/ObtainLocalAccessToken",{params:{provider:s.provider,externalAccessToken:s.externalAccessToken}}).success(function(e){r.set("authorizationData",{token:e.access_token,email:e.email,refreshToken:"",useRefreshTokens:!1}),a.isAuth=!0,a.email=e.email,a.useRefreshTokens=!1,o.resolve(e)}).error(function(e,t){h(),o.reject(e)}),o.promise},p=function(s){var o=t.defer();return e.post(n+"api/account/registerexternal",s).success(function(e){r.set("authorizationData",{token:e.access_token,email:e.email,refreshToken:"",useRefreshTokens:!1}),a.isAuth=!0,a.email=e.email,a.useRefreshTokens=!1,o.resolve(e)}).error(function(e,t){h(),o.reject(e)}),o.promise};return o.saveRegistration=u,o.login=c,o.getUserbyUsername=f,o.logOut=h,o.fillAuthData=l,o.authentication=a,o.refreshToken=k,o.obtainAccessToken=m,o.externalAuthData=i,o.registerExternal=p,o}]);